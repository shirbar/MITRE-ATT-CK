from openpyxl import load_workbook
import re

# This function extract only the event IDs from a string, using a regular expressions library,
# returns a list of event IDs
def extract_EventID_From_Str(str):
    return re.findall('[\d]*[-][\d]+|[\d]+[.\d]+', str)

# Open Malware Archaeology excels sheet file
workbook = load_workbook(filename="WindowsMalware.xlsx")
sheet = workbook["Win_Logging_Basic"]

# initialize sheet values that are necessary for create the hashmap
rowsNum = sheet.max_row
columnsNum = sheet.max_column
Green_Hex = "FF92D050"
Yellow_Hex = "FFFFFF00"

# Create a malware HashMap
MalwareHashMap = {}

# Run on the cells in the sheet for creating the hashmap
for i in range(6, rowsNum):
    Tactice = sheet.cell(i,4).value
    for j in range (5,columnsNum):
        cellColor = str(sheet.cell(i, j).fill.start_color.index)
        if cellColor == Green_Hex or cellColor == Yellow_Hex:
            cell = str(sheet.cell(i,j).value)
            eventIDs = extract_EventID_From_Str(cell)
            MalwareHashMap[Tactice] = eventIDs
        else:
            continue

print(MalwareHashMap)